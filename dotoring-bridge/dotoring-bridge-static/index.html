<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>DOTORING</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; background:#fff; }
      .wrap { max-width: 720px; margin: 0 auto; padding: 48px 20px; }
      h1 { margin: 0 0 12px; font-size: 28px; }
      p { margin: 0 0 20px; color: #555; line-height: 1.5; }
      button {
        border: 0; border-radius: 14px; padding: 14px 18px;
        font-size: 16px; cursor: pointer; background: #111; color:#fff;
      }
      .small { margin-top: 14px; font-size: 12px; color:#777; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <h1>DOTORING</h1>
      <p id="msg">앱으로 이동 중…</p>
      <button id="openBtn">DOTORING 앱 열기</button>
      <div class="small" id="debug"></div>
    </div>

    <script>
      // 현재 페이지 URL의 hash를 그대로 앱으로 넘김 (#access_token=...&refresh_token=...&type=recovery)
      const hash = window.location.hash || "";
      const deepLink = "dotoring://auth/recovery" + hash;

      const msg = document.getElementById("msg");
      const debug = document.getElementById("debug");
      const openBtn = document.getElementById("openBtn");

      // 디버그 표시(원하면 제거)
      debug.textContent = hash ? "복구 정보 감지됨" : "복구 정보 없음";

      function openApp() {
        // iOS/Android 모두 시도
        window.location.href = deepLink;
      }

      openBtn.addEventListener("click", openApp);

      // hash가 있으면 자동으로 열어봄(사용자 클릭도 남겨둠)
      if (hash && hash.includes("access_token")) {
        msg.textContent = "앱으로 이동 중… (안 열리면 버튼을 눌러줘)";
        setTimeout(openApp, 300);
      } else {
        msg.textContent = "복구 정보가 없어요. 메일의 링크를 다시 눌러주세요.";
      }
    </script>
  </body>
</html>
